<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parkify - System Logs</title>
  <link rel="stylesheet" href="../css/logs.css">
</head>
<body>
  <div class="logs-wrapper">
    <h1>System Logs ðŸ“œ</h1>
    <div id="logsContainer" class="logs-container">
      <p class="loading">Loading logs...</p>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "AIzaSyDWoFHHXKxEMBk-ZhZgYstPV6fylL8SLiE",
  authDomain: "parkifycapstone.firebaseapp.com",
  databaseURL: "https://parkifycapstone-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "parkifycapstone",
  storageBucket: "parkifycapstone.firebasestorage.app",
  messagingSenderId: "578453779700",
  appId: "1:578453779700:web:c34c4202c53b2152bc1aa1",
  measurementId: "G-5NCE2MM3PM"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const logsContainer = document.getElementById("logsContainer");

// --- Load logs ---
async function loadLogs() {
  logsContainer.innerHTML = '<p class="loading">Loading logs...</p>';

  try {
    const logsSnap = await get(ref(db, "logs/logs"));
    logsContainer.innerHTML = "";

    if (!logsSnap.exists()) {
      logsContainer.innerHTML = '<p class="no-logs">No logs found.</p>';
      return;
    }

    const logsData = logsSnap.val();
    const logKeys = Object.keys(logsData).sort((a, b) => {
      const timeA = logsData[a].timestamp || 0;
      const timeB = logsData[b].timestamp || 0;
      return timeB - timeA; // newest first
    });

    logKeys.forEach(key => {
      const log = logsData[key];
      const action = log.action || "Unknown Action";
      const details = log.details || "";
      const userID = log.userID || "Unknown User";
      const timestamp = log.timestamp ? new Date(log.timestamp).toLocaleString() : "N/A";

      const logItem = document.createElement("div");
      logItem.className = "log-item";
      logItem.innerHTML = `
        <div class="log-header">
          <span class="log-action">${action}</span>
          <span class="log-timestamp">${timestamp}</span>
        </div>
        <div class="log-body">
          <p>${details}</p>
          <small>UserID: ${userID}</small>
        </div>
      `;
      logsContainer.appendChild(logItem);
    });

  } catch (error) {
    console.error("Error fetching logs:", error);
    logsContainer.innerHTML = '<p class="error">Failed to load logs. Check console for details.</p>';
  }
}

loadLogs();
</script>

</body>
</html>
